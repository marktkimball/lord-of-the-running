<!DOCTYPE html>
<html>
  <head>
    <title>Image map types</title>
    <style>
      html, body, #map-canvas {
        height: 100%;
        margin: 0;
        padding: 0;
      }

    </style>
    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&signed_in=true"></script>
    <script>
var middleEarthTypeOptions = {
  getTileUrl: function(coord, zoom) {
      var normalizedCoord = getNormalizedCoord(coord, zoom);
      if (!normalizedCoord) {
        return null;
      }
      var bound = Math.pow(2, zoom);
      return 'middle_earth_map' +
          '/' + zoom + '/' + normalizedCoord.x + '/' +
          normalizedCoord.y + '.png';
  },
  tileSize: new google.maps.Size(256, 256),
  maxZoom: 4,
  minZoom: 2,
  name: 'Middle Earth'
};

var middleEarthMapType = new google.maps.ImageMapType(middleEarthTypeOptions);

function initialize() {
  var myLatlng = new google.maps.LatLng(60.25917308828177, -39.29687499999999);
  var mapOptions = {
    center: myLatlng,
    zoom: 3,
    streetViewControl: false,
    backgroundColor: '#E3B275',
    mapTypeControlOptions: {
      mapTypeIds: ['middleEarth']
    }
  };

  var map = new google.maps.Map(document.getElementById('map-canvas'),
      mapOptions);
  map.mapTypes.set('middleEarth', middleEarthMapType);
  map.setMapTypeId('middleEarth');

  var allowedBounds = new google.maps.LatLngBounds(
       new google.maps.LatLng(-30, -170),
       new google.maps.LatLng(83, 100)
  );
  var lastValidCenter = map.getCenter();

  google.maps.event.addListener(map, 'center_changed', function() {
      if (allowedBounds.contains(map.getCenter())) {
          // still within valid bounds, so save the last valid position
          lastValidCenter = map.getCenter();
          return;
      }

      // not valid anymore => return to last valid position
      map.panTo(lastValidCenter);
  });

  google.maps.event.addListener(map, 'click', function(event){
    var lat = event.latLng.lat();
    var lng = event.latLng.lng();
  })
  var frodoJourneyCoordinates = [
    new google.maps.LatLng(76.3518964311259, -107.490234375), //SHIRE
    new google.maps.LatLng(75.1633002462206, -105.29296875),
    new google.maps.LatLng(75.43097919105938, -101.337890625),
    new google.maps.LatLng(75.82365950624266, -99.228515625),
    new google.maps.LatLng(76.12189296324114, -96.064453125), //OLD FOREST
    new google.maps.LatLng(75.73730278940472, -93.076171875),
    new google.maps.LatLng( 75.36450565060709 , -90.087890625 ),
    new google.maps.LatLng( 75.27541260821627 , -89.208984375 ),
    new google.maps.LatLng( 75.60680105154304 , -89.560546875 ),
    new google.maps.LatLng( 76.12189296324114 , -88.41796875 ),
    new google.maps.LatLng( 76.67978490310692 , -86.396484375 ), //BREE
    new google.maps.LatLng( 76.70001918871924 , -83.408203125 ),
    new google.maps.LatLng( 76.76054111175668 , -81.03515625 ),
    new google.maps.LatLng( 76.49631101453927 , -78.92578125 ),
    new google.maps.LatLng( 76.55774293896553 , -74.794921875 ), //WEATHERTOP
    new google.maps.LatLng( 76.413973015132 , -71.982421875 ),
    new google.maps.LatLng( 76.24781659441473 , -70.927734375 ),
    new google.maps.LatLng( 76.16399261609192 , -69.345703125 ),
    new google.maps.LatLng( 76.31035754301745 , -66.533203125 ),
    new google.maps.LatLng( 76.51681887717322 , -64.3359375 ),
    new google.maps.LatLng( 76.6595203909583 , -61.787109375 ),
    new google.maps.LatLng( 76.96033358827414 , -60.380859375 ), //EAST BRIDGE
    new google.maps.LatLng( 76.94048839176438 , -57.919921875 ),
    new google.maps.LatLng( 77.0591158825237 , -55.986328125 ),
    new google.maps.LatLng( 77.19617635994676 , -54.052734375 ),
    new google.maps.LatLng( 77.19617635994676 , -52.03125 ),
    new google.maps.LatLng( 77.07878389624943 , -50.185546875 ),
    new google.maps.LatLng( 76.9007089258869 , -48.69140625 ),
    new google.maps.LatLng( 76.55774293896553 , -47.548828125 ),
    new google.maps.LatLng( 76.39331166244496 , -45.966796875 ), //RIVENDELL
    new google.maps.LatLng( 76.63922560965885 , -44.384765625 ),
    new google.maps.LatLng( 76.98014914976217 , -43.76953125 ),
    new google.maps.LatLng( 76.59854506890699 , -44.208984375 ),
    new google.maps.LatLng( 76.07966773378998 , -44.384765625 ),
    new google.maps.LatLng( 75.73730278940472 , -44.384765625 ),
    new google.maps.LatLng( 75.18578927942625 , -44.560546875 ),
    new google.maps.LatLng( 74.70644988318502 , -45.52734375 ),
    new google.maps.LatLng( 74.30735341486246 , -46.23046875 ),
    new google.maps.LatLng( 73.77577986189993 , -47.021484375 ),
    new google.maps.LatLng( 73.403337662912 , -47.4609375 ),
    new google.maps.LatLng( 72.91963546581482 , -48.1640625 ),
    new google.maps.LatLng( 72.28906720017675 , -48.8671875 ), //START FAILED MOUNTAIN PASS
    new google.maps.LatLng( 71.7739410364347 , -48.69140625 ),
    new google.maps.LatLng( 71.32895017791998 , -48.69140625 ),
    new google.maps.LatLng( 71.55274065141299 , -46.845703125 ),
    new google.maps.LatLng( 71.82883956585103 , -44.912109375 ),
    new google.maps.LatLng( 72.04683989379397 , -42.890625 ),
    new google.maps.LatLng( 72.23551372557404 , -41.484375 ), //TURN AROUND FOR FAILED MOUNTAIN PASS
    new google.maps.LatLng( 71.99257805093251 , -42.71484375 ),
    new google.maps.LatLng( 71.80141030136785 , -44.296875 ),
    new google.maps.LatLng( 71.60828252210263 , -45.791015625 ),
    new google.maps.LatLng( 71.30079291637452 , -47.4609375 ),
    new google.maps.LatLng( 71.10254274232307 , -49.658203125 ),
    new google.maps.LatLng( 70.72897946208789 , -50.44921875 ), //ENTER MORIA
    new google.maps.LatLng( 70.19999407534661 , -51.240234375 ),
    new google.maps.LatLng( 69.83962194067463 , -51.6796875 ),
    new google.maps.LatLng( 69.28725695167886 , -51.328125 ),
    new google.maps.LatLng( 69.41124235697256 , -49.5703125 ),
    new google.maps.LatLng( 69.62651016802958 , -47.724609375 ),
    new google.maps.LatLng( 69.65708627301174 , -46.845703125 ),
    new google.maps.LatLng( 69.59589006237648 , -45.966796875 ),
    new google.maps.LatLng( 69.4421276134176 , -44.912109375 ),
    new google.maps.LatLng( 69.4421276134176 , -43.681640625 ),
    new google.maps.LatLng( 69.65708627301174 , -42.802734375 ),
    new google.maps.LatLng( 69.25614923150721 , -41.572265625 ),
    new google.maps.LatLng( 69.00567519658819 , -40.693359375 ),
    new google.maps.LatLng( 68.942606818121 , -40.078125 ),
    new google.maps.LatLng( 68.72044056989829 , -39.638671875 ),
    new google.maps.LatLng( 68.43151284537514 , -39.19921875 ), //EXIT MORIA
    new google.maps.LatLng( 68.23682270936281 , -38.935546875 ),
    new google.maps.LatLng( 67.84241647327927 , -38.408203125 ),
    new google.maps.LatLng( 67.7760253890732 , -36.73828125 ), //ENTER LORIEN
    new google.maps.LatLng( 67.60922060496382 , -35.15625 ),
    new google.maps.LatLng( 67.44122869796348 , -33.75 ),
    new google.maps.LatLng( 67.13582938531948 , -31.552734375 ),
    new google.maps.LatLng( 66.75724984139227 , -30.05859375 ),
    new google.maps.LatLng( 66.30220547599842 , -28.65234375 ), //EXIT LORIEN START RIVER
    new google.maps.LatLng( 65.47650756256367 , -28.65234375 ),
    new google.maps.LatLng( 64.92354174306496 , -28.4765625 ),
    new google.maps.LatLng( 64.47279382008166 , -27.421875 ),
    new google.maps.LatLng( 64.20637724320852 , -26.279296875 ),
    new google.maps.LatLng( 64.16810689799152 , -25.3125 ),
    new google.maps.LatLng( 63.860035895395306 , -24.2578125 ),
    new google.maps.LatLng( 63.548552232036414 , -23.5546875 ),
    new google.maps.LatLng( 63.074865690586634 , -22.587890625 ),
    new google.maps.LatLng( 62.95522304515911 , -21.796875 ),
    new google.maps.LatLng( 62.71446210149774 , -20.654296875 ),
    new google.maps.LatLng( 62.63376960786813 , -19.951171875 ),
    new google.maps.LatLng( 62.552856958572896 , -18.896484375 ),
    new google.maps.LatLng( 62.2679226294176 , -18.720703125 ),
    new google.maps.LatLng( 61.64816245852389 , -18.896484375 ),
    new google.maps.LatLng( 61.10078883158897 , -19.51171875 ),
    new google.maps.LatLng( 60.80206374467983 , -19.86328125 ),
    new google.maps.LatLng( 60.1524422143808 , -20.21484375 ),
    new google.maps.LatLng( 59.7563950493563 , -19.951171875 ),
    new google.maps.LatLng( 59.5343180010956 , -18.80859375 ),
    new google.maps.LatLng( 59.44507509904716 , -17.666015625 ),
    new google.maps.LatLng( 59.57885104663186 , -16.34765625 ),
    new google.maps.LatLng( 60.06484046010452 , -15.29296875 ),
    new google.maps.LatLng( 60.06484046010452 , -14.94140625 ),
    new google.maps.LatLng( 59.62332522313024 , -14.326171875 ),
    new google.maps.LatLng( 59.0405546167585 , -13.88671875 ),
    new google.maps.LatLng( 58.49369382056807 , -14.23828125 ),
    new google.maps.LatLng( 57.844750992891 , -15.556640625 ),
    new google.maps.LatLng( 57.51582286553882 , -16.875 ),
    new google.maps.LatLng( 57.18390185831188 , -16.875 ),
    new google.maps.LatLng( 56.75272287205736 , -16.611328125 ),
    new google.maps.LatLng( 56.413901376006756 , -15.908203125 ),
    new google.maps.LatLng( 56.218923189166624 , -14.94140625 ),
    new google.maps.LatLng( 55.97379820507658 , -14.23828125 ),
    new google.maps.LatLng( 55.578344672182055 , -13.88671875 ),
    new google.maps.LatLng( 54.876606654108684 , -13.623046875 ),
    new google.maps.LatLng( 53.9560855309879 , -13.623046875 ),
    new google.maps.LatLng( 53.38332836757153 , -14.0625 ),
    new google.maps.LatLng( 52.696361078274485 , -14.853515625 ),
    new google.maps.LatLng( 51.890053935216926 , -15.29296875 ),
    new google.maps.LatLng( 51.01375465718821 , -15.29296875 ),
    new google.maps.LatLng( 50.45750402042058 , -15.1171875 ),
    new google.maps.LatLng( 49.61070993807422 , -14.58984375 ),
    new google.maps.LatLng( 48.80686346108517 , -14.150390625 ),
    new google.maps.LatLng( 47.931066347509784 , -13.7109375 ),
    new google.maps.LatLng( 47.279229002570816 , -13.271484375 ),
    new google.maps.LatLng( 46.61926103617151 , -13.271484375 ),
    new google.maps.LatLng( 46.01222384063236 , -13.271484375 ),
    new google.maps.LatLng( 45.27488643704894 , -13.18359375 ), //END OF RIVER
    new google.maps.LatLng( 45.82879925192134 , -12.568359375 ),
    new google.maps.LatLng( 46.13417004624326 , -11.6015625 ), //CROSS RIVER
    new google.maps.LatLng( 46.73986059969267 , -11.6015625 ),
    new google.maps.LatLng( 47.33882269482199 , -10.72265625 ),
    new google.maps.LatLng( 47.57652571374621 , -9.228515625 ),
    new google.maps.LatLng( 48.16608541901253 , -7.646484375 ),
    new google.maps.LatLng( 48.10743118848038 , -6.15234375 ),
    new google.maps.LatLng( 48.10743118848038 , -4.74609375 ),
    new google.maps.LatLng( 48.22467264956519 , -3.69140625 ), //START OF DEAD MARSHES
    new google.maps.LatLng( 47.517200697839414 , -1.7578125 ),
    new google.maps.LatLng( 46.92025531537451 , -0.263671875 ),
    new google.maps.LatLng( 46.61926103617151 , 0.966796875 ),
    new google.maps.LatLng( 46.195042108660154 , 2.28515625 ),
    new google.maps.LatLng( 45.706179285330855 , 3.779296875 ),
    new google.maps.LatLng( 45.02695045318546 , 5.2734375 ),
    new google.maps.LatLng( 44.5278427984555 , 4.5703125 ), //END OF DEAD MARSHES
    new google.maps.LatLng( 43.89789239125797 , 4.21875 ),
    new google.maps.LatLng( 42.94033923363181 , 3.955078125 ),
    new google.maps.LatLng( 41.96765920367816 , 3.33984375 ),
    new google.maps.LatLng( 41.178653972331674 , 3.076171875 ),
    new google.maps.LatLng( 40.44694705960048 , 2.63671875 ),
    new google.maps.LatLng( 39.36827914916011 , 2.109375 ),
    new google.maps.LatLng( 38.548165423046584 , 2.109375 ),
    new google.maps.LatLng( 37.43997405227057 , 2.28515625 ),
    new google.maps.LatLng( 36.52729481454624 , 2.63671875 ),
    new google.maps.LatLng( 35.53222622770337 , 3.1640625 ),
    new google.maps.LatLng( 34.59704151614417 , 3.427734375 ),
    new google.maps.LatLng( 33.43144133557529 , 3.427734375 ),
    new google.maps.LatLng( 32.39851580247402 , 3.779296875 ),
    new google.maps.LatLng( 30.977609093348686 , 4.130859375 ),
    new google.maps.LatLng( 30.977609093348686 , 5.09765625 ), //MINAS MORGUL
    new google.maps.LatLng( 31.50362930577303 , 6.328125 ),
    new google.maps.LatLng( 31.728167146023935 , 7.3828125 ),
    new google.maps.LatLng( 31.728167146023935 , 8.525390625 ),
    new google.maps.LatLng( 31.42866311735861 , 10.01953125 ), //SHELOB
    new google.maps.LatLng( 31.05293398570514 , 10.810546875 ),
    new google.maps.LatLng( 30.524413269923986 , 11.77734375 ),
    new google.maps.LatLng( 30.221101852485983 , 12.65625 ), //LEAVE SHELOB
    new google.maps.LatLng( 30.14512718337613 , 13.88671875 ), //MORDOR
    new google.maps.LatLng( 31.353636941500987 , 13.88671875 ),
    new google.maps.LatLng( 32.62087018318113 , 13.623046875 ),
    new google.maps.LatLng( 33.50475906922606 , 13.359375 ),
    new google.maps.LatLng( 34.59704151614417 , 12.83203125 ),
    new google.maps.LatLng( 35.67514743608467 , 12.12890625 ),
    new google.maps.LatLng( 36.73888412439431 , 11.865234375 ),
    new google.maps.LatLng( 36.949891786813296 , 10.1953125 ),
    new google.maps.LatLng( 37.3002752813443 , 9.052734375 ),
    new google.maps.LatLng( 37.64903402157866 , 9.755859375 ),
    new google.maps.LatLng( 37.92686760148135 , 10.72265625 ),
    new google.maps.LatLng( 38.20365531807149 , 11.25 ),
    new google.maps.LatLng( 38.685509760012 , 12.12890625 ),
    new google.maps.LatLng( 39.50404070558415 , 12.392578125 ),
    new google.maps.LatLng( 40.17887331434696 , 13.18359375 ),
    new google.maps.LatLng( 40.17887331434696 , 14.765625 ),
    new google.maps.LatLng( 40.245991504199026 , 15.908203125 ),
    new google.maps.LatLng( 40.17887331434696 , 17.138671875 ),
    new google.maps.LatLng( 40.04443758460859 , 18.193359375 ),
    new google.maps.LatLng( 39.639537564366684 , 18.80859375 ),
    new google.maps.LatLng( 39.027718840211605 , 19.3359375 ),
    new google.maps.LatLng( 38.479394673276445 , 19.3359375 ),
    new google.maps.LatLng( 37.85750715625203 , 19.423828125 ),
    new google.maps.LatLng( 37.23032838760387 , 19.423828125 ), //MT DOOM
    new google.maps.LatLng( 36.5978891330702 , 19.423828125 ),
    new google.maps.LatLng( 36.1733569352216 , 19.6875 ),
    new google.maps.LatLng( 35.60371874069731 , 19.51171875 ) //RING IN MT DOOM
  ];
  var frodoJourney = new google.maps.Polyline({
    path: frodoJourneyCoordinates,
    geodesic: false,
    strokeColor: '#FF0000',
    strokeOpacity: 1.0,
    strokeWeight: 4
  });

  frodoJourney.setMap(map);

  //5.04257 ME miles to 1 mile ratio to get accurate distance
}

google.maps.LatLng.prototype.miTo = function(a){
    var e = Math, ra = e.PI/180;
    var b = this.lat() * ra, c = a.lat() * ra, d = b - c;
    var g = this.lng() * ra - a.lng() * ra;
    var f = 2 * e.asin(e.sqrt(e.pow(e.sin(d/2), 2) + e.cos(b) * e.cos
    (c) * e.pow(e.sin(g/2), 2)));
    return f * 3959;
}

google.maps.Polyline.prototype.inMi = function(n){
    var a = this.getPath(n), len = a.getLength(), dist = 0;
    for (var i=0; i < len-1; i++) {
       dist += a.getAt(i).miTo(a.getAt(i+1));
    }
    return dist;
}



// Normalizes the coords that tiles repeat across the x axis (horizontally)
// like the standard Google map tiles.
function getNormalizedCoord(coord, zoom) {
  var y = coord.y;
  var x = coord.x;

  // tile range in one direction range is dependent on zoom level
  // 0 = 1 tile, 1 = 2 tiles, 2 = 4 tiles, 3 = 8 tiles, etc
  var tileRange = 1 << zoom;

  // don't repeat across y-axis (vertically)
  if (y < 0 || y >= tileRange) {
    return null;
  }

  // repeat across x-axis
  // if (x < 0 || x >= tileRange) {
  //   x = (x % tileRange + tileRange) % tileRange;
  // }

  return {
    x: x,
    y: y
  };
}

google.maps.event.addDomListener(window, 'load', initialize);

      </script>
  </head>
  <body>
    <div id="map-canvas"></div>
  </body>
</html>
